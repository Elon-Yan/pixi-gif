<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>PixiJS AnimatedGIF Demo</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <script async src="https://www.googletagmanager.com/gtag/js?id=UA-103772589-10"></script>
        <script>
            window.dataLayer = window.dataLayer || [];
            function gtag(){dataLayer.push(arguments);}
            gtag('js', new Date());
            gtag('config', 'UA-103772589-10');
        </script>
        <script src="https://pixijs.download/dev/pixi-legacy.min.js"></script>
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" />
        <script src="../dist/pixi-gif.js"></script>
        <style>
            .frame {
                max-width: 500px;
            }
        </style>
    </head>
    <body>

        <div class="frame container pt-5">
            <div class="row text-center mb-5">
                <h1>@pixi/gif Demo</h1>
            </div>
            <div class="row justify-content-center">
                <div class="col text-center">
                    <h2 class="mb-3">PixiJS</h2>
                    <canvas id="root"></canvas>
                </div>
                <div class="col text-center">
                    <h2 class="mb-3">Original GIF</h2>
                    <img src="example.gif">
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <input id="slider" class="form-range" type="range" min="0" max="0" value="0" step="1" /><br>
                </div>
            </div>
            <div class="row">
                <div class="col-6">
                    <div class="btn-group d-flex w-100 mb-2">
                        <button id="play" class="btn btn-primary">Play</button>
                        <button id="stop" class="btn btn-primary">Stop</button>
                    </div>
                    <div class="form-check">
                        <input class="form-check-input" type="checkbox" id="loop" />
                        <label class="form-check-label" for="loop">Loop</label>
                    </div>
                </div>
            </div>
        </div>
        <script>
            
            const $ = document.querySelector.bind(document);
            
            // Install the plugin
            PIXI.Loader.registerPlugin(PIXI.gif.AnimatedGIFLoader);

            // Boilerplate create application
            const app = new PIXI.Application({
                width: 150,
                height: 189,
                backgroundColor: 0xffffff,
                view: $('#root'),
            });

            // Load the GIF image
            app.loader.add('image', 'example.gif');
            app.loader.load((loader) => {
                const image = loader.resources.image.animation;
                app.stage.addChild(image);
                // Handle the slider
                const slider = $('#slider');
                image.onFrameChange = (value) => slider.value = value;
                image.onLoop = () => console.log('Looped!');
                image.onComplete = () => console.log('Completed!');

                slider.max = image.totalFrames - 1;
                slider.addEventListener('input', () => image.currentFrame = slider.value);

                // Setup loop check
                const loop = $('#loop');
                loop.checked = image.loop;
                loop.addEventListener('change', () => image.loop = loop.checked);

                $('#play').addEventListener('click', () => {
                    // slider.disabled = true;
                    image.play();
                });
                $('#stop').addEventListener('click', () => {
                    // slider.disabled = false;
                    image.stop();
                });
            });
        </script>
        
    </body>
</html>